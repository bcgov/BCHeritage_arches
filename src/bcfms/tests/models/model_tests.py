from tests.base_test import ArchesTestCase
from bcfms.models.business import IPA
from django.contrib.auth.models import Group, User
from django.test.client import Client
from django.test.testcases import TestCase
from django.db import connection
from arches.app.utils.i18n import get_localized_value


class IPAModelTests(ArchesTestCase):
    graph_fixtures = ["Contributor", "Fossil Collection Event", "Industry Project Assessment"]

    @classmethod
    def setUpClass(cls):
        super().setUpClass()
        cls.setUpTestData()

    @classmethod
    def setUpTestData(cls):
        print("IPAModelTests.setUpTestData")
        super().setUpTestData()
        cls.client = Client()
        print("Users: %s" % User.objects.all())
        cls.admin = User.objects.get(username="admin")
        cls.anonymous = User.objects.get(username="anonymous")
        print("IPAModelTests.setUpTestData")
        cursor = connection.cursor()
        sql_statements = [
            """INSERT INTO industry_project_assessment.instances (resourceinstanceid, legacyid, graphid, createdtime, descriptors, name, graphpublicationid, transactionid) VALUES ('681f535f-2eab-4f0e-8673-c748b5f6f452', null, '2aa724d1-ffd3-4823-8ff1-15a385b9a407', '2024-11-22 09:41:26.002212 +00:00', '{"en": {"name": "2024-12-01 - Brett''s other test.", "map_popup": "<dt>Location Description</dt><dd>Esquimalt area.</dd><br><dt>Project Type</dt><dd>Airport</dd>", "description": "<dt>Location Description</dt><dd>Esquimalt area.</dd><br><dt>Project Initiator</dt><dd>Ferg, B</dd><br><dt>Project Type</dt><dd>Airport</dd>"}}', '{"en": "2024-12-01 - Brett''s other test."}', '4e16039a-8d6b-11ef-8ac7-0242ac170007', 'a685110a-a883-11ef-b006-0242ac170007');""",
            """INSERT INTO industry_project_assessment.instances (resourceinstanceid, legacyid, graphid, createdtime, descriptors, name, graphpublicationid, transactionid) VALUES ('a82a68fb-9e5e-4634-8d92-9dd8998b3d64', null, '2aa724d1-ffd3-4823-8ff1-15a385b9a407', '2024-12-06 03:17:40.682636 +00:00', '{"en": {"name": "2024-12-11 - Brett''s Test", "map_popup": "<dt>Location Description</dt><dd>Here and there.</dd><br><dt>Project Type</dt><dd>Adventure tourism</dd>", "description": "<dt>Location Description</dt><dd>Here and there.</dd><br><dt>Project Initiator</dt><dd>Ferg, B</dd><br><dt>Project Type</dt><dd>Adventure tourism</dd>"}}', '{"en": "2024-12-11 - Brett''s Test"}', '4e16039a-8d6b-11ef-8ac7-0242ac170007', '5c234a0c-b34e-11ef-80b8-0242ac170009');""",
            """INSERT INTO industry_project_assessment.project_details (tileid, project_completed, project_end_date, project_authorizing_agency, project_start_date, land_act_file_number, project_name, project_initiator, industry_company_name, resourceinstanceid, nodegroupid, transactionid) VALUES ('47beb840-3833-499a-8416-0e62de6fa24c', null, null, 'f667e523-99a1-43cc-b34c-258e186019f5', '2024-12-01 00:00:00.000000', null, '{"de": {"value": "", "direction": "ltr"}, "el": {"value": "", "direction": "ltr"}, "en": {"value": "Brett''s other test.", "direction": "ltr"}, "fr": {"value": "", "direction": "ltr"}, "pt": {"value": "", "direction": "ltr"}, "ru": {"value": "", "direction": "ltr"}, "zh": {"value": "", "direction": "ltr"}, "en-US": {"value": "", "direction": "ltr"}, "en-us": {"value": "", "direction": "ltr"}}', '[{"resourceId": "2dd0af66-bb53-4e73-a551-67b06e9b25de", "ontologyProperty": "ac41d9be-79db-4256-b368-2f4559cfbe55", "resourceXresourceId": "96d81f38-2f2b-48aa-864c-d921b8d6e495", "inverseOntologyProperty": "ac41d9be-79db-4256-b368-2f4559cfbe55"}]', '{"de": {"value": "", "direction": "ltr"}, "el": {"value": "", "direction": "ltr"}, "en": {"value": "IBM", "direction": "ltr"}, "fr": {"value": "", "direction": "ltr"}, "pt": {"value": "", "direction": "ltr"}, "ru": {"value": "", "direction": "ltr"}, "zh": {"value": "", "direction": "ltr"}, "en-US": {"value": "", "direction": "ltr"}, "en-us": {"value": "", "direction": "ltr"}}', '681f535f-2eab-4f0e-8673-c748b5f6f452', '5dfe07ea-9dc0-11ed-82b6-5254004d77d3', 'af9deeb4-b7de-11ef-9940-0242ac170007');""",
            """INSERT INTO industry_project_assessment.project_details (tileid, project_completed, project_end_date, project_authorizing_agency, project_start_date, land_act_file_number, project_name, project_initiator, industry_company_name, resourceinstanceid, nodegroupid, transactionid) VALUES ('a0ddc2bd-3d88-42f4-96b2-cfecd818793d', null, null, 'f667e523-99a1-43cc-b34c-258e186019f5', '2024-12-05 00:00:00.000000', null, '{"de": {"value": "", "direction": "ltr"}, "el": {"value": "", "direction": "ltr"}, "en": {"value": "Brett''s Test", "direction": "ltr"}, "fr": {"value": "", "direction": "ltr"}, "pt": {"value": "", "direction": "ltr"}, "ru": {"value": "", "direction": "ltr"}, "zh": {"value": "", "direction": "ltr"}, "en-US": {"value": "", "direction": "ltr"}, "en-us": {"value": "", "direction": "ltr"}}', '[{"resourceId": "2dd0af66-bb53-4e73-a551-67b06e9b25de", "ontologyProperty": "ac41d9be-79db-4256-b368-2f4559cfbe55", "resourceXresourceId": "2bd56eb6-cb0c-4f52-a20b-b1c14e929791", "inverseOntologyProperty": "ac41d9be-79db-4256-b368-2f4559cfbe55"}]', null, 'a82a68fb-9e5e-4634-8d92-9dd8998b3d64', '5dfe07ea-9dc0-11ed-82b6-5254004d77d3', '5c234a0c-b34e-11ef-80b8-0242ac170009');""",
            """INSERT INTO industry_project_assessment.project_site (tileid, project_location, geometry_qualifier, location_description, multiple_geometry_qualifier, project_details, resourceinstanceid, nodegroupid, transactionid) VALUES ('10186d7d-a9f8-4c3c-98a7-04cabd5f8a87', '0106000020E6100000020000000103000000010000000500000097273518C6E55EC0666B9E9FEFC64840E8ACCDC84AF05EC06D413F901CD7484002EC4AD88BD15EC0D62B2B0B8DDA4840EE8BDF712BD65EC01EF8B9673CC7484097273518C6E55EC0666B9E9FEFC648400103000000010000000500000090FDC79C24F65EC0E0A7415EB9CC484007185306CCFC5EC0E4B17E84F2D44840C5CDB4A839F55EC0AD0B36B10CDE4840DA90E0973CF35EC0225CC18094D1484090FDC79C24F65EC0E0A7415EB9CC4840', null, '{"de": {"value": "", "direction": "ltr"}, "el": {"value": "", "direction": "ltr"}, "en": {"value": "Here and there.", "direction": "ltr"}, "fr": {"value": "", "direction": "ltr"}, "pt": {"value": "", "direction": "ltr"}, "ru": {"value": "", "direction": "ltr"}, "zh": {"value": "", "direction": "ltr"}, "en-US": {"value": "", "direction": "ltr"}, "en-us": {"value": "", "direction": "ltr"}}', '{"de": {"value": "", "direction": "ltr"}, "el": {"value": "", "direction": "ltr"}, "en": {"value": "Focus areas.", "direction": "ltr"}, "fr": {"value": "", "direction": "ltr"}, "pt": {"value": "", "direction": "ltr"}, "ru": {"value": "", "direction": "ltr"}, "zh": {"value": "", "direction": "ltr"}, "en-US": {"value": "", "direction": "ltr"}, "en-us": {"value": "", "direction": "ltr"}}', 'a0ddc2bd-3d88-42f4-96b2-cfecd818793d', 'a82a68fb-9e5e-4634-8d92-9dd8998b3d64', 'd4d462c2-9e58-11ed-b6d5-5254004d77d3', '0d3a1028-b34f-11ef-89cf-0242ac170009');""",
            """INSERT INTO industry_project_assessment.project_site (tileid, project_location, geometry_qualifier, location_description, multiple_geometry_qualifier, project_details, resourceinstanceid, nodegroupid, transactionid) VALUES ('bad13419-7c26-44e0-9848-9fb389c316ca', '0106000020E6100000010000000103000000010000000E0000009E6EB505B8D95EC02C808336253548405653223666DB5EC012D75B44EF3548403215814912DC5EC0CAC074E7E337484010C95A2426DC5EC018AA101EF73948403880B9F42DDB5EC08F8C0B593D3A4840D0F87C17F8D85EC0F87D53E2B0394840962597F5CAD75EC049D81BCC743848406D59326064D75EC0B202799884364840962597F5CAD75EC0380FF78D9A364840F644A33CE4D85EC05BFC43AD58364840123E9F9012D95EC0711B14618D364840BA6030CD1FD95EC0A7178A7BE6354840E1A552463AD95EC02C5751E36F3548409E6EB505B8D95EC02C80833625354840', 'eba38764-cdff-4d3d-9cc4-b5587aab8b9c', '{"de": {"value": "", "direction": "ltr"}, "el": {"value": "", "direction": "ltr"}, "en": {"value": "Esquimalt area.", "direction": "ltr"}, "fr": {"value": "", "direction": "ltr"}, "pt": {"value": "", "direction": "ltr"}, "ru": {"value": "", "direction": "ltr"}, "zh": {"value": "", "direction": "ltr"}, "en-US": {"value": "", "direction": "ltr"}, "en-us": {"value": "", "direction": "ltr"}}', '{"de": {"value": "", "direction": "ltr"}, "el": {"value": "", "direction": "ltr"}, "en": {"value": "Esquimalt project", "direction": "ltr"}, "fr": {"value": "", "direction": "ltr"}, "pt": {"value": "", "direction": "ltr"}, "ru": {"value": "", "direction": "ltr"}, "zh": {"value": "", "direction": "ltr"}, "en-US": {"value": "", "direction": "ltr"}, "en-us": {"value": "", "direction": "ltr"}}', '47beb840-3833-499a-8416-0e62de6fa24c', '681f535f-2eab-4f0e-8673-c748b5f6f452', 'd4d462c2-9e58-11ed-b6d5-5254004d77d3', '03012904-b7df-11ef-aac5-0242ac170007');""",
            """INSERT INTO industry_project_assessment.project_site (tileid, project_location, geometry_qualifier, location_description, multiple_geometry_qualifier, project_details, resourceinstanceid, nodegroupid, transactionid) VALUES ('42708db8-06e8-4c34-be9d-585c67339b2b', '0106000020E610000001000000010300000001000000050000007CEEC67CF0E25EC0724A60CE1DC848409D12C34463EA5EC0B0742AE951D648408CAE632DB9DE5EC07C93B961C5DF48405DF990C035DB5EC09362227664C948407CEEC67CF0E25EC0724A60CE1DC84840', null, '{"de": {"value": "", "direction": "ltr"}, "el": {"value": "", "direction": "ltr"}, "en": {"value": "Over there", "direction": "ltr"}, "fr": {"value": "", "direction": "ltr"}, "pt": {"value": "", "direction": "ltr"}, "ru": {"value": "", "direction": "ltr"}, "zh": {"value": "", "direction": "ltr"}, "en-US": {"value": "", "direction": "ltr"}, "en-us": {"value": "", "direction": "ltr"}}', '{"de": {"value": "", "direction": "ltr"}, "el": {"value": "", "direction": "ltr"}, "en": {"value": "Overall site.", "direction": "ltr"}, "fr": {"value": "", "direction": "ltr"}, "pt": {"value": "", "direction": "ltr"}, "ru": {"value": "", "direction": "ltr"}, "zh": {"value": "", "direction": "ltr"}, "en-US": {"value": "", "direction": "ltr"}, "en-us": {"value": "", "direction": "ltr"}}', 'a0ddc2bd-3d88-42f4-96b2-cfecd818793d', 'a82a68fb-9e5e-4634-8d92-9dd8998b3d64', 'd4d462c2-9e58-11ed-b6d5-5254004d77d3', '04cf8166-b34f-11ef-8e4a-0242ac170009');""",
            """INSERT INTO industry_project_assessment.project_type (tileid, project_type, other_project_type, proposed_activity, project_details, resourceinstanceid, nodegroupid, transactionid) VALUES ('119e5dd3-859e-425c-9281-e10614ac9fcb', 'a8a07943-8f99-4491-9291-a7458542520c', null, '{"de": {"value": "", "direction": "ltr"}, "el": {"value": "", "direction": "ltr"}, "en": {"value": "Esquimalt airport - 737s only.", "direction": "ltr"}, "fr": {"value": "", "direction": "ltr"}, "pt": {"value": "", "direction": "ltr"}, "ru": {"value": "", "direction": "ltr"}, "zh": {"value": "", "direction": "ltr"}, "en-US": {"value": "", "direction": "ltr"}, "en-us": {"value": "", "direction": "ltr"}}', '47beb840-3833-499a-8416-0e62de6fa24c', '681f535f-2eab-4f0e-8673-c748b5f6f452', '416e539a-a357-11ed-932e-5254004d77d3', '0fa4fba4-b7df-11ef-be73-0242ac170007');""",
            """INSERT INTO industry_project_assessment.project_type (tileid, project_type, other_project_type, proposed_activity, project_details, resourceinstanceid, nodegroupid, transactionid) VALUES ('5d7fb5ca-623c-42dc-b38a-18745118cc37', 'aef1e8ce-160e-4cde-879c-53dae363f13f', null, '{"de": {"value": "", "direction": "ltr"}, "el": {"value": "", "direction": "ltr"}, "en": {"value": "Sky diving", "direction": "ltr"}, "fr": {"value": "", "direction": "ltr"}, "pt": {"value": "", "direction": "ltr"}, "ru": {"value": "", "direction": "ltr"}, "zh": {"value": "", "direction": "ltr"}, "en-US": {"value": "", "direction": "ltr"}, "en-us": {"value": "", "direction": "ltr"}}', 'a0ddc2bd-3d88-42f4-96b2-cfecd818793d', 'a82a68fb-9e5e-4634-8d92-9dd8998b3d64', '416e539a-a357-11ed-932e-5254004d77d3', '5231f34c-b7de-11ef-a842-0242ac170007');""",
            """INSERT INTO industry_project_assessment.assessment_start_date (tileid, assessment_completion_date, assessment_start_date, resourceinstanceid, nodegroupid, transactionid) VALUES ('3dec9c25-518d-4906-962f-bd157d48892d', null, '2024-12-11 00:00:00.000000', 'a82a68fb-9e5e-4634-8d92-9dd8998b3d64', '67997a7e-9dc4-11ed-9ef3-5254004d77d3', '5f80f6ba-b7de-11ef-9bfb-0242ac170007');""",
            """INSERT INTO industry_project_assessment.assessment_start_date (tileid, assessment_completion_date, assessment_start_date, resourceinstanceid, nodegroupid, transactionid) VALUES ('ea2133d4-1e0b-4ce8-a8bb-37323d8a6bd1', null, '2024-12-01 00:00:00.000000', '681f535f-2eab-4f0e-8673-c748b5f6f452', '67997a7e-9dc4-11ed-9ef3-5254004d77d3', '1383ef14-b7df-11ef-be73-0242ac170007');""",
            """INSERT INTO industry_project_assessment.initial_project_review (tileid, proximity_to_fossils, quaternary_deposits, metamorphic_rock, intersects_ifa, initial_review_outcome, ground_disturbance, initial_review_internal_notes, frpr, sedimentary_rock, initial_review_level_of_risk, igneous_rock, resourceinstanceid, nodegroupid, transactionid) VALUES ('6be98a6c-a558-4637-9511-3f100fc33665', '998866dd-fd55-465f-9291-4e2a04683300', '680841a5-c24f-4206-ba47-06dd6170ddbc', '4127979e-7516-4644-96ec-3a8681db3ad7', true, '{"de": {"value": "", "direction": "ltr"}, "el": {"value": "", "direction": "ltr"}, "en": {"value": "This is a relatively low risk project.", "direction": "ltr"}, "fr": {"value": "", "direction": "ltr"}, "pt": {"value": "", "direction": "ltr"}, "ru": {"value": "", "direction": "ltr"}, "zh": {"value": "", "direction": "ltr"}, "en-US": {"value": "", "direction": "ltr"}, "en-us": {"value": "", "direction": "ltr"}}', 'd7f1a189-c4ce-45d8-8d8f-f722d2bec14d', null, '58dce13d-a85d-40d9-8492-fe1294c498c7', '74ec3e28-714b-4308-b463-e228ca385280', 'b43fe9e6-7741-4fcd-a1ba-767aeefb364c', '1f6c48d8-49fc-418d-a08c-d968d0976512', '681f535f-2eab-4f0e-8673-c748b5f6f452', '91e50dd8-9dca-11ed-9ef3-5254004d77d3', '386edec4-b7df-11ef-be73-0242ac170007');""",
        ]
        for statement in sql_statements:
            cursor.execute(statement)

    def test_get_ipas(self):
        # self.client.force_login(self.admin)
        assert(len(IPA.objects.all()), 2, "Invalid number of IPAs")

    def test_get_ipa_json(self):
        for ipa in IPA.objects.all():
            print(ipa.to_json())

    def test_get_ipa(self):
        # self.client.force_login(self.admin)
        for ipa in IPA.objects.all():
            print("IPAs: %s" % get_localized_value(ipa.get_project_name()[0]))

