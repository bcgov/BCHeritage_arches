BCRHP 1.3.0 release notes
------------------------
Release to update Arches Core to 7.6.x

### Bug fixes and enhancements

### Dependency changes:
None

### 1. BEFORE UPGRADING (!!! IMPORTANT !!!)

1. Update the maintenance page with appropriate dates and details. Maintenance page is found at `/sw_ux/httpd0(1|2)/www/html/maintenance.html`
2. Put system into maintenance mode:
```shell
touch /apps_ux/apps_(dlvr|test|prod)/maintenance/bcrhp
```
3. Confirm system in maintenance mode by accessing:
`https://(|dlvr|test)apps.nrs.gov.bc.ca/bcrhp`. System should not be live, and maintenance page should be displayed.
4. Backup database:
```shell
sudo -u wwwadm /bin/bash
cd /apps_ux/apps_[env]/backups/database
chmod 700 .
pg_dump -Upostgres bcrhp_[env] > 2024-10-15_bcrhp_pre_1.3.0.sql
gzip 2024-10-15_bcrhp_pre_1.3.0.sql
chmod 400 2024-10-15_bcrhp_pre_1.3.0.sql.gz
chmod 500 .
```

### 2. Perform Application deployment
Need to update the vhosts.conf to point to the 3.12 version of the WSGI library
Need to restart the Apache HTTPD server before the build_development call
to pick up the new VENV
The `migrations` variable must be set as follows (empty line ensure migrations are complete):
```yaml
migrations:
  - "bcrhp 1081_drop_materialized_views"
  - "models"
  - ""
```

### 3. Reindex the database
After all migrations have been completed the database needs to be re-indexed to
pickup the geometry feature IDs.
```shell
sudo -uwwwadm /bin/bash
cd /apps_ux/apps_<env>
source bcrhp_<env>_venv/bin/activate
cd bcrhp
python manage.py bc_reindex_database
```

### 4. Restart the apache server
```shell
sudo systemctl restart httpd0(1|2)
```

### 5. Rebuild the frontend assets and perform collectstatic
```shell
sudo -uwwwadm /bin/bash
cd /apps_ux/apps_<env>
source bcrhp_<env>_venv/bin/activate
cd bcrhp
source ~/setup_proxy
rm -Rf bcrhp/staticfiles bcrhp/media/build
npm run build_development
python manage.py collectstatic
```

### 6. Restart the apache server
```shell
sudo systemctl restart httpd0(1|2)
```

### 6. Restart the celery broker
The celery broker needs to be restarted to pickup the source code changes.
```shell
sudo -uwwwsvr /bin/bash
s6-svc -d /apps_ux/s6_services/bcrhp_celery_<env>/
s6-svc -u /apps_ux/s6_services/bcrhp_celery_<env>/
```