{% extends "views/report-templates/default.htm" %}
{% load i18n %}
<!-- ko if: !$data.configForm -->
<!-- ko if: !$data.summary -->
{% block report %}


{% block report_title_bar %}
<!-- Report Title Bar -->
<div class="relative report-title-bar">

    <!-- BCRHP Title Block -->
    <div class="report-toolbar-preview ep-form-toolbar">
        <h4 class="report-toolbar-title"><span class="bc-report-title" data-bind="html: report.get('name')"></span> -
            <span class="bc-report-title" data-bind="html: report.get('displayname') "></span></h4>

        <!-- Tools -->
        <div class="ep-form-toolbar-tools mar-no flex">
            <p class="report-print-date">
                <span data-bind="text: $root.translations.reportDate"></span>
                <span data-bind="text: reportDate"></span>
            </p>

            <div
                class="report-print-date"
                data-bind="component: {
                    name: 'views/components/simple-switch',
                    params: {
                        value: hideEmptyNodes,
                        config:{ label: $root.translations.hideNullValues, subtitle: ''}
                    }
                }"
            ></div>
    </div>
</div>
</div>
{% endblock report_title_bar %}


<!-- Report Content -->
<div class="rp-report-container-preview">

{% block header %}
<div>
    <!-- ko if: featureCount() > 0 || report.preview -->
    <div data-bind="component: {
      name: 'report-header-map',
      params: $data
  }" class="report-map-header-component"></div>
    <!-- /ko -->
</div>
{% endblock header %}

{% block body %}
<!--ko if: hasProvisionalData() && (editorContext === false) -->
    <div class="report-provisional-flag"><span data-bind="text: $root.translations.pendingProvisionalEditsNotDisplayed"></span></div>
<!--/ko-->
<!--ko if: hasProvisionalData() && (editorContext === true && report.userisreviewer === true) -->
    <div class="report-provisional-flag"><span data-bind="text: $root.translations.pendingProvisionalEditsNotDisplayed"></span></div>
<!--/ko-->
<!--ko if: hasProvisionalData() && (editorContext === true && report.userisreviewer === false) -->
    <div class="report-provisional-flag"><span data-bind="text: $root.translations.pendingProvisionalEdits"></div>
<!--/ko-->

<div class="rp-report-section relative rp-report-section-root">
    <div class="rp-report-section-title bc-columns-report">
        <!-- ko foreach: { data: report.cards, as: 'card' } -->
        <!-- ko if: $parent.hideEmptyNodes() === false || card.tiles().length > 0 -->
                <!-- ko if: $index() !== 0 --><hr class="rp-tile-separator"><!-- /ko -->
        <div class="rp-card-section">
            <!-- ko component: {
                name: card.model.cardComponentLookup[card.model.component_id()].componentname,
                params: {
                    state: 'report',
                    preview: $parent.report.preview,
                    card: card,
                    pageVm: {...$root, report: $parent.report},
                    hideEmptyNodes: $parent.hideEmptyNodes
                }
            } --> <!-- /ko -->
        </div>
        <!-- /ko -->
        <!-- /ko -->
    </div>
</div>
{% endblock body %}


    {% block related_resources %}
    <div class="rp-report-section relative report-related-resources">
        <div class="rp-report-section-title">
            <h4 class="rp-section-title"><span data-bind="text: $root.translations.relatedResources" ></span></h4>
        </div>

        <!-- ko foreach: { data: Object.values(report.relatedResourcesLookup()), as: 'resourceData' } -->
        <!-- ko if: resourceData.totalRelatedResources > 0 || !$parent.hideEmptyNodes() -->
        <h5 class="rp-tile-title">
            <span class="rp-tile-title-float" data-bind="text: resourceData.name"></span>
        </h5>

        <div class="rp-card-section">
            <!-- ko foreach: { data: resourceData.loadedRelatedResources(), as: 'relatedResource' } -->
            <div class="rp-report-container-tile">
                <div class="row rp-report-tile">
                    <dl class="dl-horizontal">
                        <dt><a data-bind="text: relatedResource.displayName, attr: {href: relatedResource.link}"></a></dt>
                        <!-- ko if: relatedResource.relationship -->
                        <dd data-bind="text: '( ' + relatedResource.relationship + ' )'"></dd>
                        <!-- /ko -->
                    </dl>
                </div>
            </div>
            <!-- /ko -->

            <!-- ko if: resourceData.paginator() && resourceData.paginator().has_next -->
            <button class="btn btn-primary" data-bind="click: $parent.report.getRelatedResources.bind($parent.report, false)">
                <span data-bind="text: $root.translations.loadMore" ></span>
                <span data-bind="text: '(' + resourceData.remainingResources() + ')'"></span>
            </button>

            <button class="btn btn-primary" data-bind="click: $parent.report.getRelatedResources.bind($parent.report, true)">
                <span data-bind="text: $root.translations.loadAll" ></span>
                <span data-bind="text: '(' + (resourceData.totalRelatedResources - resourceData.loadedRelatedResources().length) + ')'"></span>
            </button>
            <!-- /ko -->

            <!--ko if: resourceData.totalRelatedResources === 0 -->
            <div class="rp-report-container-tile">
                <div class="row rp-report-tile rp-no-data"><span data-bind="text: $root.translations.noRelationshipsAdded"></span></div>
            </div>
            <!--/ko-->
        </div>
        <!-- /ko -->
        <!-- /ko -->
    </div>
    {% endblock related_resources %}

    {% block footer %}
    {% endblock footer %}
</div>
{% endblock report %}
<!-- /ko -->

<!-- ko if: $data.summary -->
    {% block summary %}
<div class="relative report-title-bar">

    <!-- Title Block -->
    <div class="report-toolbar-preview ep-form-toolbar">
        <h4 class="report-toolbar-title"><span class="bc-report-title" data-bind="text: report.get('name')"></span> -
            <span class="bc-report-title" data-bind="html: report.get('displayname') "></span></h4>

        <!-- Tools -->
        <div class="ep-form-toolbar-tools mar-no flex">
            <p class="report-print-date">
                <span data-bind="text: reportDate"></span>
                <span data-bind="text: reportDate"></span>
            </p>
        </div>
    </div>
</div>

<div class="rp-report-container-preview">
    <div class="rp-report-section relative rp-report-section-root">
        <div class="rp-report-section-title">
            <div class="rp-card-section">
                <div class="bcrhp-grid-container">
                    <div class="bcrhp-grid-item grid-col-1 grid-row-1">
                        <!-- ko let: { card: getCardWithName('Site Names') } -->
                        <!-- ko let: { widget: getWidgetWithLabel(card, 'Name') } -->
                        <dl class="dl-vertical dl-vertical-bc" >
                                <dt data-bind="text: widget.label()"></dt>
                                <dd>
                                <!-- ko foreach: { data: card.tiles, as: 'tile' } -->
                                <div data-bind="component: {
                                            name: widget.widgetLookup[widget.widget_id()].name,
                                            params: {
                                                tile: tile,
                                                node: widget.node,
                                                config: widget.config,
                                                label: widget.label(),
                                                value: tile.data[widget.attributes.node_id()],
                                                state: 'display_value',
                                            }
                                        }, click: function(){console.log(card);},
                                        css: {'provisional': ko.unwrap(tile.provisionaledits) !== null && tile.userisreviewer === false}"></div>
                                <!-- /ko -->
                                </dd>
                        </dl>
                        <!-- /ko -->
                        <!-- /ko -->
                    </div>
                    <div class="bchrp-grid-item grid-col-2 grid-col-2 grid-row-1">
                            <!-- ko let: { card: getCardWithName('Borden Number') } -->
                            <!-- ko let: { widget: getWidgetWithLabel(card, 'Borden Number') } -->
                            <!-- ko foreach: { data: card.tiles, as: 'tile' } -->
                            <dl class="dl-vertical dl-vertical-bc"
                                data-bind="css: {'provisional': ko.unwrap(tile.provisionaledits) !== null && tile.userisreviewer === false}">
                                <!-- ko if: tileIndex() === 0 -->
                                <dt data-bind="text: widget.label()"></dt>
                                <!-- /ko -->
                                <dd data-bind="component: {
                                            name: widget.widgetLookup[widget.widget_id()].name,
                                            params: {
                                                tile: tile,
                                                node: widget.node,
                                                config: widget.config,
                                                label: widget.label(),
                                                value: tile.data[widget.attributes.node_id()],
                                                state: 'display_value',
                                            }
                                        }, click: function(){console.log(card);}"></dd>
                            </dl>
                            <!-- /ko -->
                            <!-- /ko -->
                            <!-- /ko -->
                        </div>

                    <div class="grid-row-1 grid-col-3 bc-details-images">
                    <!-- ko let: { photocard: getCardWithName('Images') } -->
                    <!-- ko let: { photoWidget: getWidgetWithLabel(photocard, 'Site Image') } -->
                        <!-- ko let: { titleWidget: getWidgetWithLabel(photocard, 'Image Title') } -->
                        <!-- ko let: { descriptionWidget: getWidgetWithLabel(photocard, 'Image Description') } -->
                        <dl class="dl-vertical">
                            <dt></dt>
                            <dd>
                                <!-- ko foreach: { data: photocard.tiles, as: 'phototile' } -->
                                <span data-bind="component: {
                                            name: 'photo-widget',
                                            params: {
                                                tile: phototile,
                                                node: photoWidget.node,
                                                config: photoWidget.config,
                                                value: phototile.data[photoWidget.attributes.node_id()],
                                                imageTitle: phototile.data[titleWidget.attributes.node_id()],
                                                imageDescription: phototile.data[descriptionWidget.attributes.node_id()],
                                                state: 'display_value',
                                            }
                                        }, click: function(event){console.log(photocard);}"></span>
                                <!-- /ko -->

                            </dd>
                        </dl>
                        <!-- /ko -->
                        <!-- /ko -->
                    <!-- /ko -->
                    <!-- /ko -->
                </div>
                    <div class="bcrhp-grid-item grid-col-1 grid-row-2">
                        <!-- ko let: { card: getCardWithName(['Heritage Site Location', 'BC Property Address']) } -->
                        <!-- ko foreach: { data: card.tiles, as: 'tile' } -->
                        <dl class="dl-vertical dl-vertical-bc"
                            data-bind="css: {'provisional': ko.unwrap(tile.provisionaledits) !== null && tile.userisreviewer === false}">
                            <!-- ko if: tileIndex() === 0 -->
                            <dt data-bind="text: 'Civic Addresses'"></dt>
                            <!-- /ko -->
                            <dd data-bind="component: {
                                            name: 'civic-address-widget',
                                            params: {
                                                tile: tile,
                                                card: card,
                                                value: tile.data,
                                                state: 'display_value',
                                            }
                                        }, click: function(){console.log(card);}"></dd>
                        </dl>
                        <!-- /ko -->
                        <!-- /ko -->
                    </div>
                    <div class="bcrhp-grid-item grid-col-2 grid-row-2">
                        <!-- ko let: { card: getCardWithName('Official Recognition Information') } -->
                        <!-- ko let: { widget: getWidgetWithLabel(card, 'Registry Types') } -->
                        <!-- ko foreach: { data: card.tiles, as: 'tile' } -->
                        <dl class="dl-vertical dl-vertical-bc"
                            data-bind="css: {'provisional': ko.unwrap(tile.provisionaledits) !== null && tile.userisreviewer === false}">
                            <!-- ko if: tileIndex() === 0 -->
                            <dt data-bind="text: widget.label()"></dt>
                            <!-- /ko -->
                            <dd data-bind="component: {
                                            name: widget.widgetLookup[widget.widget_id()].name,
                                            params: {
                                                tile: tile,
                                                node: widget.node,
                                                config: widget.config,
                                                label: widget.label(),
                                                value: tile.data[widget.attributes.node_id()],
                                                state: 'display_value'
                                            }
                                        }, click: function(){console.log(card);}"></dd>
                        </dl>
                        <!-- /ko -->
                        <!-- /ko -->
                        <!-- /ko -->
                    </div>
                    <div class="bcrhp-grid-item grid-col-1 grid-row-3">
                        <!-- ko let: { card: getCardWithName('Chronology') } -->
                        <!-- ko foreach: { data: card.tiles, as: 'tile' } -->
                        <dl class="dl-vertical dl-vertical-bc"
                            data-bind="css: {'provisional': ko.unwrap(tile.provisionaledits) !== null && tile.userisreviewer === false}">
                            <!-- ko if: tileIndex() === 0 -->
                            <dt data-bind="text: `Significant Events`"></dt>
                            <!-- /ko -->
                            <dd data-bind="component: {
                                            name: 'significant-event-widget',
                                            params: {
                                                tile: tile,
                                                card: card,
                                                value: tile.data,
                                                state: 'display_value',
                                                event_types: ['Construction']
                                            }
                                        }, click: function(){console.log(card);}"></dd>
                        </dl>
                        <!-- /ko -->
                        <!-- /ko -->
                    </div>
                    <div class="bcrhp-grid-item grid-col-2 grid-row-3">
                        <!-- ko let: { card: getCardWithName(['Official Recognition Information', 'Official Recognition Details']) } -->
                        <!-- ko let: { widget: getWidgetWithLabel(card, 'Legislative Act') } -->
                        <!-- ko if: !!card.tiles && card.tiles().length > 0 -->
                        <dl class="dl-vertical dl-vertical-bc">
                            <dt data-bind="text: widget.label()"></dt>
                            <dd>
                                <!-- ko foreach: { data: card.tiles, as: 'tile' } -->
                                <div data-bind="component: {
                                            name: widget.widgetLookup[widget.widget_id()].name,
                                            params: {
                                                tile: tile,
                                                node: widget.node,
                                                config: widget.config,
                                                label: widget.label(),
                                                value: tile.data[widget.attributes.node_id()],
                                                state: 'display_value',
                                            }
                                        }, click: function(){console.log(card);},
                                        css: {'provisional': ko.unwrap(tile.provisionaledits) !== null && tile.userisreviewer === false}"></div>
                                <!-- /ko -->
                            </dd>
                        </dl>
                        <!-- /ko -->
                        <!-- /ko -->
                        <!-- /ko -->
                    </div>

                    <div class="bcrhp-grid-item bcrhp-full-width-grid-item bc-top-offset">
                        <!-- ko let: { card: getCardWithName('Statement of Significance') } -->
                        <!-- ko let: { widget: getWidgetWithLabel(card, 'Significance Description') } -->
                        <!-- ko let: { sigTypeWidget: getWidgetWithLabel(card, 'Significance Type') } -->
                        <!-- ko foreach: { data: card.tiles, as: 'tile' } -->
                        <dl class="dl-vertical dl-vertical-bc" data-bind="css: {'provisional': ko.unwrap(tile.provisionaledits) !== null && tile.userisreviewer === false}">
                            <!-- ko if: tileIndex() === 0 -->
                            <dt data-bind="text: widget.label()"></dt>
                            <!-- /ko -->
                            <dd style="text-decoration: underline;" data-bind="component: {
                                            name: sigTypeWidget.widgetLookup[sigTypeWidget.widget_id()].name,
                                            params: {
                                                tile: tile,
                                                node: sigTypeWidget.node,
                                                config: sigTypeWidget.config,
                                                displayfullvalue: true,
                                                value: tile.data[sigTypeWidget.attributes.node_id()],
                                                state: 'display_value',
                                            }
                                        }, click: function(){console.log(card);}"></dd>
                            <dd data-bind="component: {
                                            name: widget.widgetLookup[widget.widget_id()].name,
                                            params: {
                                                tile: tile,
                                                node: widget.node,
                                                config: widget.config,
                                                displayfullvalue: true,
                                                value: tile.data[widget.attributes.node_id()],
                                                state: 'display_value',
                                            }
                                        }, click: function(){console.log(card);}"></dd>
                        </dl>
                        <!-- /ko -->
                        <!-- /ko -->
                        <!-- /ko -->
                        <!-- /ko -->
                    </div>


                </div>

            </div>
        </div>
    </div>
</div>
{% endblock summary %}
<!-- /ko -->
<!-- end of not configForm -->
<!-- /ko -->


<!-- ko if: $data.configForm && ($data.configType === 'header') -->
{% block header_form %}
<!-- ko component: {
    name: 'map-widget',
    params: {
        config: report.configJSON,
        node: null,
        value: null,
        configForm: true,
        type: "report-header",
        graph: report.graph
    }
} --><!-- /ko -->
{% endblock header_form %}
<!-- /ko -->
